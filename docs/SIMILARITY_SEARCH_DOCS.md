# Dokumentasi Sistem Similarity Search dengan LLM Fallback

## Gambaran Umum

Sistem ini menggabungkan database vector (pgvector di Supabase) dengan LLM (Gemini) untuk memberikan jawaban yang lebih akurat dan relevan dengan konteks aplikasi. Ketika pengguna mengirimkan pertanyaan:

1. Pertanyaan dikonversi ke embedding vector menggunakan OpenAI API
2. Dilakukan pencarian similaritas pada database vector documents
3. Jika ditemukan dokumen yang relevan, digunakan sebagai konteks untuk menghasilkan jawaban
4. Jika tidak ditemukan dokumen yang relevan, LLM akan menjawab berdasarkan pengetahuan umumnya

## Komponen Utama

### 1. QuestionAnsweringService
Berperan sebagai orchestrator yang menggabungkan:
- Embedding generation melalui EmbeddingService
- Similarity search melalui SupabaseService
- Response generation melalui GeminiService

### 2. EmbeddingService
Mengubah teks pertanyaan menjadi vector embedding menggunakan OpenAI API.

### 3. SupabaseService
Melakukan pencarian similarity pada tabel `vector_documents` di Supabase.

### 4. ChatHistoryProvider
Mengelola alur chat dan menampilkan indikator sumber jawaban (Database/AI).

## Alur Data

```
User Query → EmbeddingService → SupabaseService → QuestionAnsweringService → GeminiService → Response
```

## Struktur Database

### Tabel `vector_documents`
```sql
create table public.vector_documents (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone null default now(),
  title text null,
  content text not null,
  embedding extensions.vector not null,
  constraint vector_documents_pkey primary key (id)
) TABLESPACE pg_default;
```

### Function `match_documents`
Fungsi PL/pgSQL yang melakukan pencarian similaritas berdasarkan embedding.

## Cara Menambahkan Data

### 1. Buat File JSON dengan Data Anda
Buat file JSON dengan format berikut:
```json
[
  {
    "title": "Olahraga saat Menstruasi",
    "content": "Olahraga ringan seperti yoga, jalan kaki, atau berenang dapat membantu mengurangi kram menstruasi. Hindari latihan intensitas tinggi pada hari-hari berat."
  },
  {
    "title": "Nutrisi untuk Fase Folikular",
    "content": "Selama fase folikular, konsumsi makanan kaya zat besi, protein, dan karbohidrat kompleks untuk membantu pemulihan energi setelah menstruasi."
  }
]
```

### 2. Buat Script untuk Memproses dan Menyimpan Data
Buat script yang:
1. Membaca data JSON
2. Mengubah konten menjadi embeddings
3. Menyimpan ke Supabase

## Pengembangan Selanjutnya

1. **Fine-tuning Model LLM**: Lakukan fine-tuning pada model untuk lebih memahami konteks menstruasi dan olahraga
2. **Sistem Umpan Balik**: Tambahkan mekanisme umpan balik pengguna untuk meningkatkan kualitas jawaban
3. **Pengayaan Database**: Tambahkan lebih banyak konten spesifik tentang menstruasi, olahraga, dan kesehatan perempuan
4. **Personalisasi**: Integrasikan dengan data personal pengguna untuk memberikan jawaban yang lebih personal
